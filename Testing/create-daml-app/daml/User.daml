-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

module User where

-- MAIN_TEMPLATE_BEGIN
template User with
    username: Party
    following: [Party]
    votes: [Bool]
    subject: Text
    
  where
    signatory username
    observer following
-- MAIN_TEMPLATE_END

    key username: Party
    maintainer key

    -- FOLLOW_BEGIN
    nonconsuming choice Follow: ContractId User with
        userToFollow: Party
      controller username
      do
        assertMsg "You cannot follow yourself" (userToFollow /= username)
        assertMsg "You cannot follow the same user twice" (notElem userToFollow following)
        archive self
        create this with following = userToFollow :: following
    -- FOLLOW_END
    nonconsuming choice Vote: ContractId User with
        vote: Bool
        
      controller username
      do
        -- assertMsg "You cannot follow yourself" (userToFollow /= username)
        -- assertMsg "You cannot follow the same user twice" (notElem userToFollow following)
        archive self
        create this with votes = vote :: votes

    nonconsuming choice CreateVote: ContractId User with
        inputSubject: Text
      controller username
      do
        archive self
        create this with subject = inputSubject

        
-- template UT with
  --   username: Party
  --   following: [Text]
  --   -- test: [Text]

  -- where
  --   signatory username
    -- observer following
-- MAIN_TEMPLATE_END

    -- key username: Party
    -- maintainer key

    -- FOLLOW_BEGIN
