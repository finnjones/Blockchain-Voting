{"ast":null,"code":"import _toConsumableArray from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/regenerator/index.js\";// Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React,{useState}from\"react\";import{Button,Container,Slider,List,ListItem,ListItemText,TextField,Typography,Box,Snackbar,Grid,Divider,IconButton,Paper}from\"@mui/material\";import{Key,Ballot,Delete,Close,KeyboardReturn}from\"@mui/icons-material\";import{Voting}from\"@daml.js/create-daml-app\";import{useParty,useLedger,useStreamQueries}from\"@daml/react\";import{createHash}from\"crypto\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var voteKeys=[];var hashedVoteKeys=[];var MainView=function MainView(){var hashUsername=useParty();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),candidateList=_useState2[0],setCandidateList=_useState2[1];var _React$useState=React.useState(10),_React$useState2=_slicedToArray(_React$useState,2),value=_React$useState2[0],setValue=_React$useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),subjectText=_useState4[0],setSubjectText=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),candidateText=_useState6[0],setCandidateText=_useState6[1];var _React$useState3=React.useState({text:\"\",open:false}),_React$useState4=_slicedToArray(_React$useState3,2),Popup=_React$useState4[0],setPopup=_React$useState4[1];var assets=useStreamQueries(Voting.Voting);var ledger=useLedger();var buttonHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var button,_generateVoteKeys,_generateVoteKeys2,_voteKeys,_hashedVoteKeys,voteDetails,createVote;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();button=event.currentTarget;console.log(button.name);if(button.name===\"Create Vote\",assets.contracts.length===0){setPopup({text:\"Vote Created\",open:true});_generateVoteKeys=generateVoteKeys(value),_generateVoteKeys2=_slicedToArray(_generateVoteKeys,2),_voteKeys=_generateVoteKeys2[0],_hashedVoteKeys=_generateVoteKeys2[1];console.log(candidateText);voteDetails={username:hashUsername,following:_hashedVoteKeys,votes:[],voted:[],candidates:candidateList,subject:subjectText};createVote=ledger.create(Voting.Voting,voteDetails);console.log(assets);}else{setPopup({text:\"Vote In Progress\",open:true});}case 4:case\"end\":return _context.stop();}}},_callee);}));return function buttonHandler(_x){return _ref.apply(this,arguments);};}();function hash(input){return createHash(\"sha256\").update(input).digest(\"hex\");}var generateVoteKeys=function generateVoteKeys(voterCount){for(var i=0;i<voterCount;i++){var crypto=require(\"crypto\");var key=crypto.randomBytes(20).toString(\"hex\");voteKeys.push(\"\".concat(key));hashedVoteKeys.push(hash(key));}return[voteKeys,hashedVoteKeys];};var addCandidate=function addCandidate(){setCandidateText(\"\");// append candidateText to the start of candidateList\nsetCandidateList([candidateText].concat(_toConsumableArray(candidateList)));};// copy voteKeys to clipboard\nvar copyVoteKeys=function copyVoteKeys(){navigator.clipboard.writeText(voteKeys.join(\"\\n\"));setPopup({text:\"Keys Copied To Clipboard\",open:true});};// export voteKeys to csv\nvar exportVoteKeys=function exportVoteKeys(){var csv=voteKeys.join(\"\\n\");var blob=new Blob([csv],{type:\"text/csv\"});var url=URL.createObjectURL(blob);var link=document.createElement(\"a\");link.href=url;link.download=\"voteKeys.csv\";link.click();setPopup({text:\"Keys Exported\",open:true});};var handleClose=function handleClose(event,reason){if(reason===\"clickaway\"){return;}setPopup({text:\"Vote Created\",open:false});};var action=/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"close\",color:\"inherit\",onClick:handleClose,children:/*#__PURE__*/_jsx(Close,{fontSize:\"small\"})})});return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(Box,{sx:{p:1},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3,borderRadius:\"16px\"},elevation:2,children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",alignItems:\"center\",flexWrap:\"wrap\"},children:[/*#__PURE__*/_jsx(Ballot,{sx:{fontSize:45},color:\"primary\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h5\",children:\"Create A Vote\"})]}),/*#__PURE__*/_jsx(Divider,{sx:{p:0}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{pt:2},children:\"What is the vote on?\"}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsx(TextField,{id:\"outlined-basic\",label:\"Subject\",variant:\"outlined\",value:subjectText,onChange:function onChange(event){setSubjectText(event.target.value);},style:{width:\"94%\"},sx:{m:2}})}),/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",children:[\"Voters: \",value]}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsx(Slider,{value:value,\"aria-label\":\"Default\",valueLabelDisplay:\"auto\",name:\"slider\",sx:{m:2},style:{width:\"95%\"},onChange:function onChange(event){setValue(event.target.value);}})}),/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",children:[\"Candidates: \",candidateList.length]}),/*#__PURE__*/_jsxs(Box,{textAlign:\"center\",children:[/*#__PURE__*/_jsx(TextField,{id:\"outlined-basic\",label:\"Candidate\",variant:\"outlined\",value:candidateText//  onChange={handleChange}\n,onChange:function onChange(event){setCandidateText(event.target.value);},onKeyPress:function onKeyPress(event){if(event.key===\"Enter\"){event.preventDefault();addCandidate();}},style:{width:\"95%\"},sx:{m:2},InputProps:{endAdornment:/*#__PURE__*/_jsx(IconButton,{onClick:addCandidate,children:/*#__PURE__*/_jsx(KeyboardReturn,{})})}}),/*#__PURE__*/_jsx(List,{style:{width:\"95%\"},sx:{ml:2},children:candidateList.map(function(item){return/*#__PURE__*/_jsx(ListItem,{secondaryAction:/*#__PURE__*/_jsx(IconButton,{edge:\"end\",\"aria-label\":\"delete\",onClick:function onClick(e){setCandidateList(function(candidateList){return candidateList.filter(function(i){return i!==item;});});console.log(candidateList);},children:/*#__PURE__*/_jsx(Delete,{})}),children:/*#__PURE__*/_jsx(ListItemText,{primary:item})},item);})})]}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:buttonHandler,className:\"button\",name:\"Create Vote\",sx:{m:2,alignItems:\"center\"},children:\"Create Vote\"})}),/*#__PURE__*/_jsx(Snackbar,{open:Popup.open,autoHideDuration:2000,onClose:handleClose,message:Popup.text,action:action})]})}),/*#__PURE__*/_jsx(Box,{sx:{p:1},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3,borderRadius:\"16px\"},elevation:2,children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:0,children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Key,{sx:{fontSize:45},color:\"primary\"})}),/*#__PURE__*/_jsxs(Grid,{direction:\"column\",children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Typography,{variant:\"h5\",display:\"block\",children:\"Vote Keys\"})}),/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",color:\"secondary\",display:\"block\",style:{lineHeight:\"15px\"},children:\"Distribute vote keys between voters\"})})]}),/*#__PURE__*/_jsxs(Box,{textAlign:\"right\",sx:{flexGrow:1},children:[/*#__PURE__*/_jsx(Button,{sx:{margin:1},variant:\"contained\",onClick:exportVoteKeys,children:\"Export CSV\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:copyVoteKeys,children:\"Copy To Clipboard\"})]})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(List,{sx:{width:\"100%\",bgcolor:\"background.paper\",position:\"relative\",overflow:\"auto\",maxHeight:300,\"& ul\":{padding:0}},subheader:/*#__PURE__*/_jsx(\"li\",{}),children:[0].map(function(sectionId){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"ul\",{children:voteKeys.map(function(item){return/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"\".concat(item)})},\"item-\".concat(sectionId,\"-\").concat(item));})})},\"section-\".concat(sectionId));})})]})})]});};export default MainView;","map":{"version":3,"sources":["/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/src/components/MainView.tsx"],"names":["React","useState","Button","Container","Slider","List","ListItem","ListItemText","TextField","Typography","Box","Snackbar","Grid","Divider","IconButton","Paper","Key","Ballot","Delete","Close","KeyboardReturn","Voting","useParty","useLedger","useStreamQueries","createHash","voteKeys","hashedVoteKeys","MainView","hashUsername","candidateList","setCandidateList","value","setValue","subjectText","setSubjectText","candidateText","setCandidateText","text","open","Popup","setPopup","assets","ledger","buttonHandler","event","preventDefault","button","currentTarget","console","log","name","contracts","length","generateVoteKeys","voteDetails","username","following","votes","voted","candidates","subject","createVote","create","hash","input","update","digest","voterCount","i","crypto","require","key","randomBytes","toString","push","addCandidate","copyVoteKeys","navigator","clipboard","writeText","join","exportVoteKeys","csv","blob","Blob","type","url","URL","createObjectURL","link","document","createElement","href","download","click","handleClose","reason","action","p","borderRadius","display","alignItems","flexWrap","fontSize","pt","target","width","m","endAdornment","ml","map","item","e","filter","lineHeight","flexGrow","margin","bgcolor","position","overflow","maxHeight","padding","sectionId"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React, { useState } from \"react\";\n\nimport {\n  Button,\n  Container,\n  Slider,\n  List,\n  ListItem,\n  ListItemText,\n  TextField,\n  Typography,\n  Box,\n  Snackbar,\n  Grid,\n  Divider,\n  IconButton,\n  Paper,\n} from \"@mui/material\";\n\nimport {\n  Key,\n  Ballot,\n  Delete,\n  Close,\n  KeyboardReturn,\n} from \"@mui/icons-material\";\n\nimport { Voting } from \"@daml.js/create-daml-app\";\n\nimport { useParty, useLedger, useStreamQueries } from \"@daml/react\";\n\nimport { createHash } from \"crypto\";\n\nlet voteKeys: string[] = [];\nlet hashedVoteKeys: string[] = [];\nconst MainView: React.FC = () => {\n  const hashUsername = useParty();\n  const [candidateList, setCandidateList] = useState<string[]>([]);\n\n  const [value, setValue] = React.useState<number>(10);\n  const [subjectText, setSubjectText] = useState(\"\");\n  const [candidateText, setCandidateText] = useState(\"\");\n  const [Popup, setPopup] = React.useState({ text: \"\", open: false });\n\n  const assets = useStreamQueries(Voting.Voting);\n\n  const ledger = useLedger();\n  const buttonHandler = async (event: React.MouseEvent<HTMLButtonElement>) => {\n    event.preventDefault();\n    const button: HTMLButtonElement = event.currentTarget;\n    console.log(button.name);\n    if ((button.name === \"Create Vote\", assets.contracts.length === 0)) {\n      setPopup({ text: \"Vote Created\", open: true });\n      const [voteKeys, hashedVoteKeys] = generateVoteKeys(value);\n\n      console.log(candidateText);\n      const voteDetails = {\n        username: hashUsername,\n        following: hashedVoteKeys,\n        votes: [],\n        voted: [],\n        candidates: candidateList,\n        subject: subjectText,\n      };\n      const createVote = ledger.create(Voting.Voting, voteDetails);\n      console.log(assets);\n    } else {\n      setPopup({ text: \"Vote In Progress\", open: true });\n    }\n  };\n\n  function hash(input: string) {\n    return createHash(\"sha256\").update(input).digest(\"hex\");\n  }\n\n  const generateVoteKeys = (voterCount: any) => {\n    for (let i = 0; i < voterCount; i++) {\n      var crypto = require(\"crypto\");\n      var key = crypto.randomBytes(20).toString(\"hex\");\n      voteKeys.push(`${key}`);\n      hashedVoteKeys.push(hash(key));\n    }\n    return [voteKeys, hashedVoteKeys];\n  };\n\n  const addCandidate = () => {\n    setCandidateText(\"\");\n    // append candidateText to the start of candidateList\n    setCandidateList([candidateText, ...candidateList]);\n  };\n\n  // copy voteKeys to clipboard\n  const copyVoteKeys = () => {\n    navigator.clipboard.writeText(voteKeys.join(\"\\n\"));\n    setPopup({ text: \"Keys Copied To Clipboard\", open: true });\n  };\n\n  // export voteKeys to csv\n  const exportVoteKeys = () => {\n    const csv = voteKeys.join(\"\\n\");\n    const blob = new Blob([csv], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = \"voteKeys.csv\";\n    link.click();\n    setPopup({ text: \"Keys Exported\", open: true });\n  };\n\n  const handleClose = (\n    event: React.SyntheticEvent | Event,\n    reason?: string\n  ) => {\n    if (reason === \"clickaway\") {\n      return;\n    }\n\n    setPopup({ text: \"Vote Created\", open: false });\n  };\n  const action = (\n    <React.Fragment>\n      <IconButton\n        size=\"small\"\n        aria-label=\"close\"\n        color=\"inherit\"\n        onClick={handleClose}\n      >\n        <Close fontSize=\"small\" />\n      </IconButton>\n    </React.Fragment>\n  );\n\n  return (\n    <Container>\n      <Box sx={{ p: 1 }}>\n        <Paper sx={{ p: 3, borderRadius: \"16px\" }} elevation={2}>\n          <div\n            style={{\n              display: \"flex\",\n              alignItems: \"center\",\n              flexWrap: \"wrap\",\n            }}\n          >\n            <Ballot sx={{ fontSize: 45 }} color=\"primary\" />\n            <Typography variant=\"h5\">Create A Vote</Typography>\n          </div>\n          <Divider sx={{ p: 0 }} />\n\n          <Typography variant=\"h6\" sx={{ pt: 2 }}>\n            What is the vote on?\n          </Typography>\n          <Box textAlign=\"center\">\n            <TextField\n              id=\"outlined-basic\"\n              label=\"Subject\"\n              variant=\"outlined\"\n              value={subjectText}\n              onChange={(event) => {\n                setSubjectText(event.target.value);\n              }}\n              style={{ width: \"94%\" }}\n              sx={{ m: 2 }}\n            />\n          </Box>\n          <Typography variant=\"h6\">Voters: {value}</Typography>\n\n          <Box textAlign=\"center\">\n            <Slider\n              value={value}\n              aria-label=\"Default\"\n              valueLabelDisplay=\"auto\"\n              name=\"slider\"\n              sx={{ m: 2 }}\n              style={{ width: \"95%\" }}\n              onChange={(event: any) => {\n                setValue(event.target.value);\n              }}\n            />\n          </Box>\n          <Typography variant=\"h6\">\n            Candidates: {candidateList.length}\n          </Typography>\n\n          <Box textAlign=\"center\">\n            <TextField\n              id=\"outlined-basic\"\n              label=\"Candidate\"\n              variant=\"outlined\"\n              value={candidateText}\n              //  onChange={handleChange}\n              onChange={(event) => {\n                setCandidateText(event.target.value);\n              }}\n              onKeyPress={(event) => {\n                if (event.key === \"Enter\") {\n                  event.preventDefault();\n                  addCandidate();\n                }\n              }}\n              style={{ width: \"95%\" }}\n              sx={{ m: 2 }}\n              InputProps={{\n                endAdornment: (\n                  <IconButton onClick={addCandidate}>\n                    <KeyboardReturn />\n                  </IconButton>\n                ),\n              }}\n            />\n\n            <List style={{ width: \"95%\" }} sx={{ ml: 2 }}>\n              {candidateList.map((item) => (\n                <ListItem\n                  key={item}\n                  secondaryAction={\n                    <IconButton\n                      edge=\"end\"\n                      aria-label=\"delete\"\n                      onClick={(e) => {\n                        setCandidateList((candidateList) =>\n                          candidateList.filter((i) => i !== item)\n                        );\n                        console.log(candidateList);\n                      }}\n                    >\n                      <Delete />\n                    </IconButton>\n                  }\n                >\n                  <ListItemText primary={item} />\n                </ListItem>\n              ))}\n            </List>\n          </Box>\n\n          <Box textAlign=\"center\">\n            <Button\n              variant=\"contained\"\n              onClick={buttonHandler}\n              className=\"button\"\n              name=\"Create Vote\"\n              sx={{ m: 2, alignItems: \"center\" }}\n            >\n              Create Vote\n            </Button>\n          </Box>\n          <Snackbar\n            open={Popup.open}\n            autoHideDuration={2000}\n            onClose={handleClose}\n            message={Popup.text}\n            action={action}\n          />\n        </Paper>\n      </Box>\n\n      <Box sx={{ p: 1 }}>\n        <Paper sx={{ p: 3, borderRadius: \"16px\" }} elevation={2}>\n          <Grid container spacing={0}>\n            <Grid item>\n              <Key sx={{ fontSize: 45 }} color=\"primary\" />\n            </Grid>\n\n            <Grid direction=\"column\">\n              <Grid item>\n                <Typography variant=\"h5\" display=\"block\">\n                  Vote Keys\n                </Typography>\n              </Grid>\n              <Grid item>\n                <Typography\n                  variant=\"subtitle1\"\n                  color=\"secondary\"\n                  display=\"block\"\n                  style={{ lineHeight: \"15px\" }}\n                >\n                  Distribute vote keys between voters\n                </Typography>\n              </Grid>\n            </Grid>\n            <Box textAlign=\"right\" sx={{ flexGrow: 1 }}>\n              <Button\n                sx={{ margin: 1 }}\n                variant=\"contained\"\n                onClick={exportVoteKeys}\n              >\n                Export CSV\n              </Button>\n              <Button variant=\"contained\" onClick={copyVoteKeys}>\n                Copy To Clipboard\n              </Button>\n            </Box>\n          </Grid>\n\n          <Divider />\n          <List\n            sx={{\n              width: \"100%\",\n              bgcolor: \"background.paper\",\n              position: \"relative\",\n              overflow: \"auto\",\n              maxHeight: 300,\n              \"& ul\": { padding: 0 },\n            }}\n            subheader={<li />}\n          >\n            {[0].map((sectionId) => (\n              <li key={`section-${sectionId}`}>\n                <ul>\n                  {voteKeys.map((item) => (\n                    <ListItem key={`item-${sectionId}-${item}`}>\n                      <ListItemText primary={`${item}`} />\n                    </ListItem>\n                  ))}\n                </ul>\n              </li>\n            ))}\n          </List>\n        </Paper>\n      </Box>\n    </Container>\n  );\n};\n\nexport default MainView;\n"]},"metadata":{},"sourceType":"module"}