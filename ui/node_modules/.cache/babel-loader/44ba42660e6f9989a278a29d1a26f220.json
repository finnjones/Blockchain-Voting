{"ast":null,"code":"\"use strict\"; // Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createLedgerContext = void 0;\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar ledger_1 = __importDefault(require(\"@daml/ledger\"));\n/**\n * Create a [[LedgerContext]]. One should use this function, instead of the default [[DamlLedger]],\n * where one needs to be able to nest ledger interactions, by different parties or connections, within\n * one React application.\n *\n * @param contextName Used to refer to a context in case of errors.\n */\n\n\nfunction createLedgerContext(contextName) {\n  // NOTE(MH, useEffect dependencies): There are various places in this file\n  // where we need to maintain the dependencies of the `useEffect` hook manually\n  // and there's no tool to help us enfore they are correct. Thus, we need to be\n  // extra careful in these locations. If we add too many dependencies, we will\n  // make unnecessary network requests. If we forget adding some dependencies, we\n  // not make a new network request although they are required to refresh data.\n  if (contextName === void 0) {\n    contextName = \"DamlLedgerContext\";\n  }\n\n  var ledgerContext = react_1.default.createContext(undefined);\n\n  var DamlLedger = function (_a) {\n    var token = _a.token,\n        httpBaseUrl = _a.httpBaseUrl,\n        wsBaseUrl = _a.wsBaseUrl,\n        reconnectThreshold = _a.reconnectThreshold,\n        user = _a.user,\n        party = _a.party,\n        children = _a.children;\n\n    var _b = (0, react_1.useState)(0),\n        reloadToken = _b[0],\n        setReloadToken = _b[1];\n\n    var ledger = (0, react_1.useMemo)(function () {\n      return new ledger_1.default({\n        token: token,\n        httpBaseUrl: httpBaseUrl,\n        wsBaseUrl: wsBaseUrl,\n        reconnectThreshold: reconnectThreshold\n      });\n    }, [token, httpBaseUrl, wsBaseUrl, reconnectThreshold]);\n    var state = (0, react_1.useMemo)(function () {\n      return {\n        reloadToken: reloadToken,\n        triggerReload: function () {\n          return setReloadToken(function (x) {\n            return x + 1;\n          });\n        },\n        user: user,\n        party: party,\n        ledger: ledger\n      };\n    }, [party, ledger, reloadToken]);\n    return react_1.default.createElement(ledgerContext.Provider, {\n      value: state\n    }, children);\n  };\n\n  var useDamlState = function () {\n    var state = (0, react_1.useContext)(ledgerContext);\n\n    if (!state) {\n      throw Error(\"Trying to use \".concat(contextName, \" before initializing.\"));\n    }\n\n    return state;\n  };\n\n  var useParty = function () {\n    var state = useDamlState();\n    return state.party;\n  };\n\n  var useLedger = function () {\n    return useDamlState().ledger;\n  };\n\n  var useUser = function () {\n    var user = useDamlState().user;\n\n    if (!user) {\n      throw Error(\"Trying to use 'useUser' for a DamlLedger with a missing 'user' field.\");\n    } else return user;\n  };\n\n  function useQuery(template, queryFactory, queryDeps) {\n    var _this = this;\n\n    var state = useDamlState();\n\n    var _a = (0, react_1.useState)({\n      contracts: [],\n      loading: true\n    }),\n        result = _a[0],\n        setResult = _a[1];\n\n    (0, react_1.useEffect)(function () {\n      setResult({\n        contracts: [],\n        loading: true\n      });\n      var query = queryFactory ? queryFactory() : undefined;\n\n      var load = function () {\n        return __awaiter(_this, void 0, void 0, function () {\n          var contracts;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4\n                /*yield*/\n                , state.ledger.query(template, query)];\n\n              case 1:\n                contracts = _a.sent();\n                setResult({\n                  contracts: contracts,\n                  loading: false\n                });\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      }; // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n      load(); // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n    }, __spreadArray([state.ledger, state.reloadToken, template], queryDeps !== null && queryDeps !== void 0 ? queryDeps : [], true));\n    return result;\n  }\n\n  function useFetch(template, contractId) {\n    var _this = this;\n\n    var state = useDamlState();\n\n    var _a = (0, react_1.useState)({\n      contract: null,\n      loading: true\n    }),\n        result = _a[0],\n        setResult = _a[1];\n\n    (0, react_1.useEffect)(function () {\n      setResult({\n        contract: null,\n        loading: true\n      });\n\n      var load = function () {\n        return __awaiter(_this, void 0, void 0, function () {\n          var contract;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4\n                /*yield*/\n                , state.ledger.fetch(template, contractId)];\n\n              case 1:\n                contract = _a.sent();\n                setResult({\n                  contract: contract,\n                  loading: false\n                });\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      }; // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n      load(); // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n    }, [state.ledger, state.reloadToken, template, contractId]);\n    return result;\n  }\n\n  function useFetchByKey(template, keyFactory, keyDeps) {\n    var _this = this;\n\n    var state = useDamlState();\n\n    var _a = (0, react_1.useState)({\n      contract: null,\n      loading: true\n    }),\n        result = _a[0],\n        setResult = _a[1];\n\n    (0, react_1.useEffect)(function () {\n      var key = keyFactory();\n      setResult({\n        contract: null,\n        loading: true\n      });\n\n      var load = function () {\n        return __awaiter(_this, void 0, void 0, function () {\n          var contract;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4\n                /*yield*/\n                , state.ledger.fetchByKey(template, key)];\n\n              case 1:\n                contract = _a.sent();\n                setResult({\n                  contract: contract,\n                  loading: false\n                });\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      }; // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n      load(); // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n    }, __spreadArray([state.ledger, state.reloadToken, template], keyDeps !== null && keyDeps !== void 0 ? keyDeps : [], true));\n    return result;\n  }\n\n  function useStream(_a) {\n    var name = _a.name,\n        template = _a.template,\n        init = _a.init,\n        mkStream = _a.mkStream,\n        setLoading = _a.setLoading,\n        setData = _a.setData,\n        deps = _a.deps,\n        closeHandler = _a.closeHandler;\n\n    var _b = (0, react_1.useState)(init),\n        result = _b[0],\n        setResult = _b[1];\n\n    var state = useDamlState();\n    (0, react_1.useEffect)(function () {\n      setResult(init);\n\n      var _a = mkStream(state),\n          stream = _a[0],\n          debugQuery = _a[1];\n\n      console.debug(\"mount \".concat(name, \"(\").concat(template.templateId, \", ...)\"), debugQuery);\n      stream.on(\"live\", function () {\n        return setResult(function (result) {\n          return setLoading(result, false);\n        });\n      });\n      stream.on(\"change\", function (contracts) {\n        return setResult(function (result) {\n          return setData(result, contracts);\n        });\n      });\n\n      if (closeHandler) {\n        stream.on(\"close\", closeHandler);\n      } else {\n        stream.on(\"close\", function (closeEvent) {\n          if (closeEvent.code === 4000) {// deliberate call to .close, nothing to do\n          } else {\n            console.error(\"\".concat(name, \": WebSocket connection failed.\"));\n            setResult(function (result) {\n              return setLoading(result, true);\n            });\n          }\n        });\n      }\n\n      return function () {\n        console.debug(\"unmount \".concat(name, \"(\").concat(template.templateId, \", ...)\"), debugQuery);\n        stream.close();\n      }; // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n    }, __spreadArray([state.ledger, template], deps, true));\n    return result;\n  }\n\n  function useStreamQuery(template, queryFactory, queryDeps, closeHandler) {\n    return useStream({\n      name: \"useStreamQuery\",\n      template: template,\n      init: {\n        loading: true,\n        contracts: []\n      },\n      mkStream: function (state) {\n        var query = queryFactory ? [queryFactory()] : [];\n        var stream = state.ledger.streamQueries(template, query);\n        return [stream, query];\n      },\n      setLoading: function (r, b) {\n        return __assign(__assign({}, r), {\n          loading: b\n        });\n      },\n      setData: function (r, d) {\n        return __assign(__assign({}, r), {\n          contracts: d\n        });\n      },\n      deps: queryDeps !== null && queryDeps !== void 0 ? queryDeps : [],\n      closeHandler: closeHandler\n    });\n  }\n\n  function useStreamQueries(template, queryFactory, queryDeps, closeHandler) {\n    return useStream({\n      name: \"useStreamQueries\",\n      template: template,\n      init: {\n        loading: true,\n        contracts: []\n      },\n      mkStream: function (state) {\n        var query = queryFactory ? queryFactory() : [];\n        var stream = state.ledger.streamQueries(template, query);\n        return [stream, query];\n      },\n      setLoading: function (r, b) {\n        return __assign(__assign({}, r), {\n          loading: b\n        });\n      },\n      setData: function (r, d) {\n        return __assign(__assign({}, r), {\n          contracts: d\n        });\n      },\n      deps: queryDeps !== null && queryDeps !== void 0 ? queryDeps : [],\n      closeHandler: closeHandler\n    });\n  }\n\n  function useStreamFetchByKey(template, keyFactory, keyDeps, closeHandler) {\n    return useStream({\n      name: \"useStreamFetchByKey\",\n      template: template,\n      init: {\n        loading: true,\n        contract: null\n      },\n      mkStream: function (state) {\n        var key = keyFactory();\n        var stream = state.ledger.streamFetchByKeys(template, [key]);\n        return [stream, key];\n      },\n      setLoading: function (r, b) {\n        return __assign(__assign({}, r), {\n          loading: b\n        });\n      },\n      setData: function (r, d) {\n        return __assign(__assign({}, r), {\n          contract: d[0]\n        });\n      },\n      deps: keyDeps,\n      closeHandler: closeHandler\n    });\n  }\n\n  function useStreamFetchByKeys(template, keyFactory, keyDeps, closeHandler) {\n    return useStream({\n      name: \"useStreamFetchByKeys\",\n      template: template,\n      init: {\n        loading: true,\n        contracts: []\n      },\n      mkStream: function (state) {\n        var keys = keyFactory();\n        var stream = state.ledger.streamFetchByKeys(template, keys);\n        return [stream, keys];\n      },\n      setLoading: function (r, b) {\n        return __assign(__assign({}, r), {\n          loading: b\n        });\n      },\n      setData: function (r, d) {\n        return __assign(__assign({}, r), {\n          contracts: d\n        });\n      },\n      deps: keyDeps,\n      closeHandler: closeHandler\n    });\n  }\n\n  var useReload = function () {\n    var state = useDamlState();\n    return function () {\n      return state.triggerReload();\n    };\n  };\n\n  return {\n    DamlLedger: DamlLedger,\n    useParty: useParty,\n    useUser: useUser,\n    useLedger: useLedger,\n    useQuery: useQuery,\n    useFetch: useFetch,\n    useFetchByKey: useFetchByKey,\n    useStreamQuery: useStreamQuery,\n    useStreamQueries: useStreamQueries,\n    useStreamFetchByKey: useStreamFetchByKey,\n    useStreamFetchByKeys: useStreamFetchByKeys,\n    useReload: useReload\n  };\n}\n\nexports.createLedgerContext = createLedgerContext;","map":{"version":3,"sources":["../../../../../../language-support/ts/daml-react/createLedgerContext.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\n// Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n// SPDX-License-Identifier: Apache-2.0\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createLedgerContext = void 0;\nvar react_1 = __importStar(require(\"react\"));\nvar ledger_1 = __importDefault(require(\"@daml/ledger\"));\n/**\n * Create a [[LedgerContext]]. One should use this function, instead of the default [[DamlLedger]],\n * where one needs to be able to nest ledger interactions, by different parties or connections, within\n * one React application.\n *\n * @param contextName Used to refer to a context in case of errors.\n */\nfunction createLedgerContext(contextName) {\n    // NOTE(MH, useEffect dependencies): There are various places in this file\n    // where we need to maintain the dependencies of the `useEffect` hook manually\n    // and there's no tool to help us enfore they are correct. Thus, we need to be\n    // extra careful in these locations. If we add too many dependencies, we will\n    // make unnecessary network requests. If we forget adding some dependencies, we\n    // not make a new network request although they are required to refresh data.\n    if (contextName === void 0) { contextName = \"DamlLedgerContext\"; }\n    var ledgerContext = react_1.default.createContext(undefined);\n    var DamlLedger = function (_a) {\n        var token = _a.token, httpBaseUrl = _a.httpBaseUrl, wsBaseUrl = _a.wsBaseUrl, reconnectThreshold = _a.reconnectThreshold, user = _a.user, party = _a.party, children = _a.children;\n        var _b = (0, react_1.useState)(0), reloadToken = _b[0], setReloadToken = _b[1];\n        var ledger = (0, react_1.useMemo)(function () { return new ledger_1.default({ token: token, httpBaseUrl: httpBaseUrl, wsBaseUrl: wsBaseUrl, reconnectThreshold: reconnectThreshold }); }, [token, httpBaseUrl, wsBaseUrl, reconnectThreshold]);\n        var state = (0, react_1.useMemo)(function () { return ({\n            reloadToken: reloadToken,\n            triggerReload: function () { return setReloadToken(function (x) { return x + 1; }); },\n            user: user,\n            party: party,\n            ledger: ledger,\n        }); }, [party, ledger, reloadToken]);\n        return react_1.default.createElement(ledgerContext.Provider, { value: state }, children);\n    };\n    var useDamlState = function () {\n        var state = (0, react_1.useContext)(ledgerContext);\n        if (!state) {\n            throw Error(\"Trying to use \".concat(contextName, \" before initializing.\"));\n        }\n        return state;\n    };\n    var useParty = function () {\n        var state = useDamlState();\n        return state.party;\n    };\n    var useLedger = function () {\n        return useDamlState().ledger;\n    };\n    var useUser = function () {\n        var user = useDamlState().user;\n        if (!user) {\n            throw Error(\"Trying to use 'useUser' for a DamlLedger with a missing 'user' field.\");\n        }\n        else\n            return user;\n    };\n    function useQuery(template, queryFactory, queryDeps) {\n        var _this = this;\n        var state = useDamlState();\n        var _a = (0, react_1.useState)({\n            contracts: [],\n            loading: true,\n        }), result = _a[0], setResult = _a[1];\n        (0, react_1.useEffect)(function () {\n            setResult({ contracts: [], loading: true });\n            var query = queryFactory ? queryFactory() : undefined;\n            var load = function () { return __awaiter(_this, void 0, void 0, function () {\n                var contracts;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, state.ledger.query(template, query)];\n                        case 1:\n                            contracts = _a.sent();\n                            setResult({ contracts: contracts, loading: false });\n                            return [2 /*return*/];\n                    }\n                });\n            }); };\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            load();\n            // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n        }, __spreadArray([state.ledger, state.reloadToken, template], (queryDeps !== null && queryDeps !== void 0 ? queryDeps : []), true));\n        return result;\n    }\n    function useFetch(template, contractId) {\n        var _this = this;\n        var state = useDamlState();\n        var _a = (0, react_1.useState)({\n            contract: null,\n            loading: true,\n        }), result = _a[0], setResult = _a[1];\n        (0, react_1.useEffect)(function () {\n            setResult({ contract: null, loading: true });\n            var load = function () { return __awaiter(_this, void 0, void 0, function () {\n                var contract;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, state.ledger.fetch(template, contractId)];\n                        case 1:\n                            contract = _a.sent();\n                            setResult({ contract: contract, loading: false });\n                            return [2 /*return*/];\n                    }\n                });\n            }); };\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            load();\n            // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n        }, [state.ledger, state.reloadToken, template, contractId]);\n        return result;\n    }\n    function useFetchByKey(template, keyFactory, keyDeps) {\n        var _this = this;\n        var state = useDamlState();\n        var _a = (0, react_1.useState)({\n            contract: null,\n            loading: true,\n        }), result = _a[0], setResult = _a[1];\n        (0, react_1.useEffect)(function () {\n            var key = keyFactory();\n            setResult({ contract: null, loading: true });\n            var load = function () { return __awaiter(_this, void 0, void 0, function () {\n                var contract;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, state.ledger.fetchByKey(template, key)];\n                        case 1:\n                            contract = _a.sent();\n                            setResult({ contract: contract, loading: false });\n                            return [2 /*return*/];\n                    }\n                });\n            }); };\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            load();\n            // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n        }, __spreadArray([state.ledger, state.reloadToken, template], (keyDeps !== null && keyDeps !== void 0 ? keyDeps : []), true));\n        return result;\n    }\n    function useStream(_a) {\n        var name = _a.name, template = _a.template, init = _a.init, mkStream = _a.mkStream, setLoading = _a.setLoading, setData = _a.setData, deps = _a.deps, closeHandler = _a.closeHandler;\n        var _b = (0, react_1.useState)(init), result = _b[0], setResult = _b[1];\n        var state = useDamlState();\n        (0, react_1.useEffect)(function () {\n            setResult(init);\n            var _a = mkStream(state), stream = _a[0], debugQuery = _a[1];\n            console.debug(\"mount \".concat(name, \"(\").concat(template.templateId, \", ...)\"), debugQuery);\n            stream.on(\"live\", function () { return setResult(function (result) { return setLoading(result, false); }); });\n            stream.on(\"change\", function (contracts) {\n                return setResult(function (result) { return setData(result, contracts); });\n            });\n            if (closeHandler) {\n                stream.on(\"close\", closeHandler);\n            }\n            else {\n                stream.on(\"close\", function (closeEvent) {\n                    if (closeEvent.code === 4000) {\n                        // deliberate call to .close, nothing to do\n                    }\n                    else {\n                        console.error(\"\".concat(name, \": WebSocket connection failed.\"));\n                        setResult(function (result) { return setLoading(result, true); });\n                    }\n                });\n            }\n            return function () {\n                console.debug(\"unmount \".concat(name, \"(\").concat(template.templateId, \", ...)\"), debugQuery);\n                stream.close();\n            };\n            // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n        }, __spreadArray([state.ledger, template], deps, true));\n        return result;\n    }\n    function useStreamQuery(template, queryFactory, queryDeps, closeHandler) {\n        return useStream({\n            name: \"useStreamQuery\",\n            template: template,\n            init: { loading: true, contracts: [] },\n            mkStream: function (state) {\n                var query = queryFactory ? [queryFactory()] : [];\n                var stream = state.ledger.streamQueries(template, query);\n                return [stream, query];\n            },\n            setLoading: function (r, b) { return (__assign(__assign({}, r), { loading: b })); },\n            setData: function (r, d) { return (__assign(__assign({}, r), { contracts: d })); },\n            deps: queryDeps !== null && queryDeps !== void 0 ? queryDeps : [],\n            closeHandler: closeHandler,\n        });\n    }\n    function useStreamQueries(template, queryFactory, queryDeps, closeHandler) {\n        return useStream({\n            name: \"useStreamQueries\",\n            template: template,\n            init: { loading: true, contracts: [] },\n            mkStream: function (state) {\n                var query = queryFactory ? queryFactory() : [];\n                var stream = state.ledger.streamQueries(template, query);\n                return [stream, query];\n            },\n            setLoading: function (r, b) { return (__assign(__assign({}, r), { loading: b })); },\n            setData: function (r, d) { return (__assign(__assign({}, r), { contracts: d })); },\n            deps: queryDeps !== null && queryDeps !== void 0 ? queryDeps : [],\n            closeHandler: closeHandler,\n        });\n    }\n    function useStreamFetchByKey(template, keyFactory, keyDeps, closeHandler) {\n        return useStream({\n            name: \"useStreamFetchByKey\",\n            template: template,\n            init: { loading: true, contract: null },\n            mkStream: function (state) {\n                var key = keyFactory();\n                var stream = state.ledger.streamFetchByKeys(template, [key]);\n                return [stream, key];\n            },\n            setLoading: function (r, b) { return (__assign(__assign({}, r), { loading: b })); },\n            setData: function (r, d) { return (__assign(__assign({}, r), { contract: d[0] })); },\n            deps: keyDeps,\n            closeHandler: closeHandler,\n        });\n    }\n    function useStreamFetchByKeys(template, keyFactory, keyDeps, closeHandler) {\n        return useStream({\n            name: \"useStreamFetchByKeys\",\n            template: template,\n            init: { loading: true, contracts: [] },\n            mkStream: function (state) {\n                var keys = keyFactory();\n                var stream = state.ledger.streamFetchByKeys(template, keys);\n                return [stream, keys];\n            },\n            setLoading: function (r, b) { return (__assign(__assign({}, r), { loading: b })); },\n            setData: function (r, d) { return (__assign(__assign({}, r), { contracts: d })); },\n            deps: keyDeps,\n            closeHandler: closeHandler,\n        });\n    }\n    var useReload = function () {\n        var state = useDamlState();\n        return function () { return state.triggerReload(); };\n    };\n    return {\n        DamlLedger: DamlLedger,\n        useParty: useParty,\n        useUser: useUser,\n        useLedger: useLedger,\n        useQuery: useQuery,\n        useFetch: useFetch,\n        useFetchByKey: useFetchByKey,\n        useStreamQuery: useStreamQuery,\n        useStreamQueries: useStreamQueries,\n        useStreamFetchByKey: useStreamFetchByKey,\n        useStreamFetchByKeys: useStreamFetchByKeys,\n        useReload: useReload,\n    };\n}\nexports.createLedgerContext = createLedgerContext;\n//# sourceMappingURL=createLedgerContext.js.map"]},"metadata":{},"sourceType":"script"}