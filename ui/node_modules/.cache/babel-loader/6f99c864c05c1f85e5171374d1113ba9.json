{"ast":null,"code":"var _jsxFileName = \"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/src/components/LoginScreen.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useCallback } from \"react\";\nimport { Button, TextField, Paper, Typography, Grid, Box } from \"@mui/material\";\nimport Ledger from \"@daml/ledger\";\nimport { Voting } from \"@daml.js/create-daml-app\";\nimport { authConfig, httpBaseUrl } from \"../config\";\nimport { createHash } from \"crypto\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { useAuth0 } from \"@auth0/auth0-react\";\nimport LoadingButton from \"@mui/lab/LoadingButton\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\n// Hashing function that converts a string to a hash using sha256\nfunction hash(input) {\n  return createHash(\"sha256\").update(input).digest(\"hex\");\n}\n\nexport let usernameExport;\n/* A function that takes in a component and returns a component. It is used to wrap the components in\nthe landing page and the login page. */\n\nconst wrap = component => /*#__PURE__*/_jsxDEV(_Fragment, {\n  children: /*#__PURE__*/_jsxDEV(Grid, {\n    container: true,\n    direction: \"column\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    style: {\n      height: \"100vh\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      children: /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h3\",\n        color: \"primary\",\n        textAlign: \"center\",\n        children: \"Votencrypt\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 34,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      children: /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        fontWeight: \"600\",\n        color: \"primary\",\n        textAlign: \"center\",\n        children: \"Secure Voting On The Blockchain\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 40,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 39,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      children: /*#__PURE__*/_jsxDEV(Paper, {\n        sx: {\n          p: 2,\n          borderRadius: \"16px\"\n        },\n        elevation: 2,\n        children: component\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 27,\n    columnNumber: 5\n  }, this)\n}, void 0, false);\n/**\n * This function is the landing page for the app. It has two buttons, one to create a vote and one to\n * vote. The create a vote button will take you to the login page if you are not logged in. If you are\n * logged in, it will take you to the create a vote page. The vote button will take you to the vote\n * login page\n * @param  - React.FC<Props> = ({ onLogin }) => {\n * @returns A function that returns a component\n */\n\n\nexport const LandingScreen = _ref => {\n  _s();\n\n  let {\n    onLogin\n  } = _ref;\n  const {\n    loginWithPopup\n  } = useAuth0();\n  const {\n    user,\n    isAuthenticated\n  } = useAuth0();\n  const [loading, setLoading] = React.useState(false);\n  const navigate = useNavigate();\n  const login = useCallback(async credentials => {\n    try {\n      const ledger = new Ledger({\n        token: credentials.token,\n        httpBaseUrl\n      });\n      let userContract = await ledger.fetchByKey(Voting.User, credentials.party);\n\n      if (userContract === null) {\n        const userCreds = {\n          username: credentials.party\n        };\n        userContract = await ledger.create(Voting.User, userCreds);\n      }\n\n      navigate(\"/CreateVote\");\n      onLogin(credentials);\n    } catch (error) {\n      alert(`Unknown error:\\n${JSON.stringify(error)}`);\n    }\n  }, [onLogin]);\n\n  const handleLogin = async () => {\n    // if user is not undefined then run\n    if (user !== undefined) {\n      const {\n        name,\n        sub\n      } = user;\n      usernameExport = name;\n      const hashedUsername = hash(sub ? sub : \"\");\n      await login({\n        party: hashedUsername,\n        token: authConfig.makeToken(hashedUsername)\n      });\n    }\n  };\n\n  const handleLoginButton = async () => {\n    setLoading(true);\n\n    if (isAuthenticated === false) {\n      loginWithPopup({\n        screen_hint: \"signup\"\n      });\n    }\n  };\n\n  if (isAuthenticated === true && loading === true) {\n    handleLogin();\n    return /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n  } else {\n    return wrap( /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        direction: \"column\",\n        style: {\n          width: \"400px\"\n        },\n        spacing: 2,\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: /*#__PURE__*/_jsxDEV(LoadingButton, {\n            variant: \"contained\",\n            color: \"primary\",\n            onClick: handleLoginButton,\n            style: {\n              width: \"100%\"\n            },\n            loading: loading,\n            children: \"Create A Vote\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 133,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            color: \"primary\",\n            className: \"test-select-login-button\",\n            component: Link,\n            to: \"/VoteLogin\",\n            style: {\n              width: \"100%\"\n            },\n            children: \"Vote\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 9\n      }, this)\n    }, void 0, false));\n  }\n};\n/* This function is the login page for voters. It has a text field to enter the vote key and a button\nto vote. The vote button will take you to the vote page. */\n\n_s(LandingScreen, \"EohxBOtjkK8H0q/FJCoBU3Z8+qE=\", false, function () {\n  return [useAuth0, useAuth0, useNavigate];\n});\n\n_c = LandingScreen;\nexport const LoginScreenVote = _ref2 => {\n  _s2();\n\n  let {\n    onLogin\n  } = _ref2;\n  const navigate = useNavigate();\n  const [loading, setLoading] = React.useState(false);\n  const login = useCallback(async credentials => {\n    try {\n      const ledger = new Ledger({\n        token: credentials.token,\n        httpBaseUrl\n      });\n      let userContract = await ledger.fetchByKey(Voting.User, credentials.party);\n\n      if (userContract === null) {\n        const user = {\n          username: credentials.party\n        };\n        userContract = await ledger.create(Voting.User, user);\n      }\n\n      navigate(\"/Vote\");\n      onLogin(credentials);\n    } catch (error) {\n      alert(`Unknown error:\\n${JSON.stringify(error)}`);\n    }\n  }, [onLogin]);\n  const [username, setUsername] = React.useState(\"\");\n\n  const handleLogin = async () => {\n    usernameExport = username;\n    const hashedUsername = hash(username);\n    await login({\n      party: hashedUsername,\n      token: authConfig.makeToken(hashedUsername)\n    });\n  };\n\n  if (window.location.pathname.length <= \"/VoteLogin/\".length) {\n    return wrap( /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        direction: \"column\",\n        style: {\n          width: \"400px\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: /*#__PURE__*/_jsxDEV(TextField, {\n            placeholder: \"Enter Vote Key\",\n            value: username,\n            className: \"test-select-username-field\",\n            sx: {\n              paddingBottom: 2\n            },\n            style: {\n              width: \"100%\"\n            },\n            onChange: e => setUsername(e.currentTarget.value),\n            onKeyPress: e => {\n              if (e.key === \"Enter\" && username !== \"\") {\n                e.preventDefault();\n                handleLogin();\n              }\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: /*#__PURE__*/_jsxDEV(LoadingButton, {\n            color: \"primary\",\n            onClick: e => {\n              if (username !== \"\") {\n                setLoading(true);\n                e.preventDefault();\n                handleLogin();\n              }\n            },\n            loading: loading,\n            variant: \"contained\",\n            style: {\n              width: \"100%\"\n            },\n            children: \"Vote\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 9\n      }, this)\n    }, void 0, false));\n  } else {\n    // assign characters in url path after  \"/VoteLogin/\" to username\n    if (username === \"\") {\n      setUsername(window.location.pathname.substring(\"/VoteLogin/\".length, window.location.pathname.length));\n      handleLogin();\n    }\n\n    return /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      sx: {\n        display: \"flex\",\n        height: \"100vh\"\n      },\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        src: \"/preLoader.svg\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }, this);\n  }\n};\n\n_s2(LoginScreenVote, \"aHaVTxe4Af46Alt6LFtyFswB9y0=\", false, function () {\n  return [useNavigate];\n});\n\n_c2 = LoginScreenVote;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"LandingScreen\");\n$RefreshReg$(_c2, \"LoginScreenVote\");","map":{"version":3,"sources":["/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/src/components/LoginScreen.tsx"],"names":["React","useCallback","Button","TextField","Paper","Typography","Grid","Box","Ledger","Voting","authConfig","httpBaseUrl","createHash","Link","useNavigate","useAuth0","LoadingButton","hash","input","update","digest","usernameExport","wrap","component","height","p","borderRadius","LandingScreen","onLogin","loginWithPopup","user","isAuthenticated","loading","setLoading","useState","navigate","login","credentials","ledger","token","userContract","fetchByKey","User","party","userCreds","username","create","error","alert","JSON","stringify","handleLogin","undefined","name","sub","hashedUsername","makeToken","handleLoginButton","screen_hint","width","LoginScreenVote","setUsername","window","location","pathname","length","paddingBottom","e","currentTarget","value","key","preventDefault","substring","display"],"mappings":"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","sourcesContent":["import React, { useCallback } from \"react\";\nimport { Button, TextField, Paper, Typography, Grid, Box } from \"@mui/material\";\nimport Credentials from \"../Credentials\";\nimport Ledger from \"@daml/ledger\";\nimport { Voting } from \"@daml.js/create-daml-app\";\nimport { authConfig, httpBaseUrl } from \"../config\";\nimport { createHash } from \"crypto\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { useAuth0 } from \"@auth0/auth0-react\";\nimport LoadingButton from \"@mui/lab/LoadingButton\";\n\ntype Props = {\n  onLogin: (credentials: Credentials) => void;\n};\n\n// Hashing function that converts a string to a hash using sha256\nfunction hash(input: string) {\n  return createHash(\"sha256\").update(input).digest(\"hex\");\n}\n\nexport let usernameExport: any;\n\n/* A function that takes in a component and returns a component. It is used to wrap the components in\nthe landing page and the login page. */\nconst wrap: (c: JSX.Element) => JSX.Element = (component) => (\n  <>\n    <Grid\n      container\n      direction=\"column\"\n      justifyContent=\"center\"\n      alignItems=\"center\"\n      style={{ height: \"100vh\" }}\n    >\n      <Grid item>\n        <Typography variant=\"h3\" color=\"primary\" textAlign=\"center\">\n          Votencrypt\n        </Typography>\n      </Grid>\n      <Grid item>\n        <Typography\n          variant=\"h6\"\n          fontWeight=\"600\"\n          color=\"primary\"\n          textAlign=\"center\"\n        >\n          Secure Voting On The Blockchain\n        </Typography>\n      </Grid>\n      <Grid item>\n        <Paper sx={{ p: 2, borderRadius: \"16px\" }} elevation={2}>\n          {component}\n        </Paper>\n      </Grid>\n    </Grid>\n  </>\n);\n/**\n * This function is the landing page for the app. It has two buttons, one to create a vote and one to\n * vote. The create a vote button will take you to the login page if you are not logged in. If you are\n * logged in, it will take you to the create a vote page. The vote button will take you to the vote\n * login page\n * @param  - React.FC<Props> = ({ onLogin }) => {\n * @returns A function that returns a component\n */\n\nexport const LandingScreen: React.FC<Props> = ({ onLogin }) => {\n  const { loginWithPopup } = useAuth0();\n  const { user, isAuthenticated } = useAuth0();\n  const [loading, setLoading] = React.useState(false);\n\n  const navigate = useNavigate();\n\n  const login = useCallback(\n    async (credentials: Credentials) => {\n      try {\n        const ledger = new Ledger({ token: credentials.token, httpBaseUrl });\n        let userContract = await ledger.fetchByKey(\n          Voting.User,\n          credentials.party\n        );\n\n        if (userContract === null) {\n          const userCreds = {\n            username: credentials.party,\n          };\n          userContract = await ledger.create(Voting.User, userCreds);\n        }\n        navigate(\"/CreateVote\");\n\n        onLogin(credentials);\n      } catch (error) {\n        alert(`Unknown error:\\n${JSON.stringify(error)}`);\n      }\n    },\n    [onLogin]\n  );\n\n  const handleLogin = async () => {\n    // if user is not undefined then run\n\n    if (user !== undefined) {\n      const { name, sub } = user;\n\n      usernameExport = name;\n      const hashedUsername = hash(sub ? sub : \"\");\n      await login({\n        party: hashedUsername,\n        token: authConfig.makeToken(hashedUsername),\n      });\n    }\n  };\n  const handleLoginButton = async () => {\n    setLoading(true);\n    if (isAuthenticated === false) {\n      loginWithPopup({\n        screen_hint: \"signup\",\n      });\n    }\n  };\n  if (isAuthenticated === true && loading === true) {\n    handleLogin();\n    return <></>;\n  } else {\n    return wrap(\n      <>\n        <Grid\n          container\n          direction=\"column\"\n          style={{ width: \"400px\" }}\n          spacing={2}\n        >\n          <Grid item>\n            <LoadingButton\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={handleLoginButton}\n              style={{ width: \"100%\" }}\n              loading={loading}\n            >\n              Create A Vote\n            </LoadingButton>\n          </Grid>\n          <Grid item>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              className=\"test-select-login-button\"\n              component={Link}\n              to=\"/VoteLogin\"\n              style={{ width: \"100%\" }}\n            >\n              Vote\n            </Button>\n          </Grid>\n        </Grid>\n      </>\n    );\n  }\n};\n\n/* This function is the login page for voters. It has a text field to enter the vote key and a button\nto vote. The vote button will take you to the vote page. */\nexport const LoginScreenVote: React.FC<Props> = ({ onLogin }) => {\n  const navigate = useNavigate();\n  const [loading, setLoading] = React.useState(false);\n\n  const login = useCallback(\n    async (credentials: Credentials) => {\n      try {\n        const ledger = new Ledger({ token: credentials.token, httpBaseUrl });\n        let userContract = await ledger.fetchByKey(\n          Voting.User,\n          credentials.party\n        );\n\n        if (userContract === null) {\n          const user = {\n            username: credentials.party,\n          };\n          userContract = await ledger.create(Voting.User, user);\n        }\n        navigate(\"/Vote\");\n\n        onLogin(credentials);\n      } catch (error) {\n        alert(`Unknown error:\\n${JSON.stringify(error)}`);\n      }\n    },\n    [onLogin]\n  );\n  const [username, setUsername] = React.useState(\"\");\n\n  const handleLogin = async () => {\n    usernameExport = username;\n\n    const hashedUsername = hash(username);\n\n    await login({\n      party: hashedUsername,\n      token: authConfig.makeToken(hashedUsername),\n    });\n  };\n  if (window.location.pathname.length <= \"/VoteLogin/\".length) {\n    return wrap(\n      <>\n        <Grid container direction=\"column\" style={{ width: \"400px\" }}>\n          <Grid item>\n            <TextField\n              placeholder=\"Enter Vote Key\"\n              value={username}\n              className=\"test-select-username-field\"\n              sx={{ paddingBottom: 2 }}\n              style={{ width: \"100%\" }}\n              onChange={(e) => setUsername(e.currentTarget.value)}\n              onKeyPress={(e) => {\n                if (e.key === \"Enter\" && username !== \"\") {\n                  e.preventDefault();\n                  handleLogin();\n                }\n              }}\n            />\n          </Grid>\n\n          <Grid item>\n            <LoadingButton\n              color=\"primary\"\n              onClick={(e) => {\n                if (username !== \"\") {\n                  setLoading(true);\n                  e.preventDefault();\n                  handleLogin();\n                }\n              }}\n              loading={loading}\n              variant=\"contained\"\n              style={{ width: \"100%\" }}\n            >\n              Vote\n            </LoadingButton>\n          </Grid>\n        </Grid>\n      </>\n    );\n  } else {\n    // assign characters in url path after  \"/VoteLogin/\" to username\n    if (username === \"\") {\n      setUsername(\n        window.location.pathname.substring(\n          \"/VoteLogin/\".length,\n          window.location.pathname.length\n        )\n      );\n      handleLogin();\n    }\n    return (\n      <Box\n        display=\"flex\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        sx={{ display: \"flex\", height: \"100vh\" }}\n      >\n        <img src=\"/preLoader.svg\" />\n      </Box>\n    );\n  }\n};\n"]},"metadata":{},"sourceType":"module"}