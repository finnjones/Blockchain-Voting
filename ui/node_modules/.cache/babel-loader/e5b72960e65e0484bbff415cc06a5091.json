{"ast":null,"code":"import _asyncToGenerator from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from\"react\";import{Button,Grid,List,ListItem,Container,FormLabel,FormControlLabel,RadioGroup,FormControl,Typography,Radio,Divider,Box,Snackbar,IconButton,Paper}from\"@mui/material\";import{Close,HowToVote,Logout}from\"@mui/icons-material\";import{Voting}from\"@daml.js/create-daml-app\";import{useParty,useLedger,useStreamQueries}from\"@daml/react\";import{Link}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var VoteScreen=function VoteScreen(_ref){var _assets$contracts$0$p,_assets$contracts$3,_assets$contracts$3$p,_assets$contracts$4,_assets$contracts$4$p;var onLogout=_ref.onLogout;var hashUsername=useParty();var ledger=useLedger();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),Popup=_React$useState2[0],setPopup=_React$useState2[1];var _React$useState3=React.useState(\"\"),_React$useState4=_slicedToArray(_React$useState3,2),popupText=_React$useState4[0],setPopupText=_React$useState4[1];var handleClose=function handleClose(event,reason){if(reason===\"clickaway\"){return;}setPopup(false);};var action=/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"close\",color:\"inherit\",onClick:handleClose,children:/*#__PURE__*/_jsx(Close,{fontSize:\"small\"})})});var assets=useStreamQueries(Voting.Voting);var userContract=ledger.fetchByKey(Voting.Voting,hashUsername);var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),radioStatus=_useState2[0],setRadioStatus=_useState2[1];// get current unix time stamp\nvar now=new Date().getTime();var buttonHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _assets$contracts$;var _assets$contracts$2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!((_assets$contracts$=assets.contracts[0])!==null&&_assets$contracts$!==void 0&&_assets$contracts$.payload.voted.includes(hashUsername))){_context.next=5;break;}setPopupText(\"You have already voted\");setPopup(true);_context.next=9;break;case 5:_context.next=7;return ledger.exerciseByKey(Voting.Voting.Vote,(_assets$contracts$2=assets.contracts[0])===null||_assets$contracts$2===void 0?void 0:_assets$contracts$2.signatories[0],{voter:hashUsername,vote:radioStatus,unixTime:now}).catch(console.error);case 7:setPopupText(\"Your vote has been cast. Please or close the browser tab\");setPopup(true);case 9:case\"end\":return _context.stop();}}},_callee);}));return function buttonHandler(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Box,{textAlign:\"right\",sx:{p:1},children:/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"inherit\",startIcon:/*#__PURE__*/_jsx(Logout,{}),onClick:onLogout,component:Link,to:\"/\",children:\"Log Out\"})}),/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsx(Grid,{container:true,direction:\"column\",justifyContent:\"center\",alignItems:\"center\",style:{height:\"75vh\"},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3,borderRadius:\"16px\",width:\"90%\"},elevation:2,children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:0,children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(HowToVote,{sx:{fontSize:50},color:\"primary\"})}),/*#__PURE__*/_jsxs(Grid,{item:true,children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Typography,{variant:\"h5\",display:\"block\",children:\"Vote\"})}),/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",color:\"secondary\",display:\"block\",style:{lineHeight:\"15px\"},children:\"Read the vote description carefully and choose an option\"})})]})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{pt:2},children:\"Vote Description\"}),(_assets$contracts$0$p=(_assets$contracts$3=assets.contracts[0])===null||_assets$contracts$3===void 0?void 0:(_assets$contracts$3$p=_assets$contracts$3.payload)===null||_assets$contracts$3$p===void 0?void 0:_assets$contracts$3$p.subject)!==null&&_assets$contracts$0$p!==void 0?_assets$contracts$0$p:\"Loading...\",/*#__PURE__*/_jsx(Divider,{sx:{pb:2}}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsxs(FormControl,{children:[/*#__PURE__*/_jsx(FormLabel,{id:\"demo-radio-buttons-group-label\",children:\"Options\"}),/*#__PURE__*/_jsx(RadioGroup,{\"aria-labelledby\":\"demo-radio-buttons-group-label\",defaultValue:\"female\",name:\"radio-buttons-group\",children:/*#__PURE__*/_jsx(List,{children:(_assets$contracts$4=assets.contracts[0])===null||_assets$contracts$4===void 0?void 0:(_assets$contracts$4$p=_assets$contracts$4.payload)===null||_assets$contracts$4$p===void 0?void 0:_assets$contracts$4$p.candidates.map(function(item){return/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(FormControlLabel,{value:item,control:/*#__PURE__*/_jsx(Radio,{}),label:item,onChange:function onChange(event){setRadioStatus(item);}})},item);})})})]})}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:buttonHandler,className:\"button\",name:\"Create Vote\",sx:{m:2,alignItems:\"center\"},children:\"Vote\"})}),/*#__PURE__*/_jsx(Snackbar,{open:Popup,autoHideDuration:4000,onClose:handleClose,message:popupText,action:action})]})})})]});};export default VoteScreen;","map":{"version":3,"sources":["/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/src/components/VoteScreen.tsx"],"names":["React","useState","Button","Grid","List","ListItem","Container","FormLabel","FormControlLabel","RadioGroup","FormControl","Typography","Radio","Divider","Box","Snackbar","IconButton","Paper","Close","HowToVote","Logout","Voting","useParty","useLedger","useStreamQueries","Link","VoteScreen","onLogout","hashUsername","ledger","Popup","setPopup","popupText","setPopupText","handleClose","event","reason","action","assets","userContract","fetchByKey","radioStatus","setRadioStatus","now","Date","getTime","buttonHandler","contracts","payload","voted","includes","exerciseByKey","Vote","signatories","voter","vote","unixTime","catch","console","error","p","height","borderRadius","width","fontSize","lineHeight","pt","subject","pb","candidates","map","item","m","alignItems"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport {\n  Button,\n  Grid,\n  List,\n  ListItem,\n  Container,\n  FormLabel,\n  FormControlLabel,\n  RadioGroup,\n  FormControl,\n  Typography,\n  Radio,\n  Divider,\n  Box,\n  Snackbar,\n  IconButton,\n  Paper,\n} from \"@mui/material\";\nimport { Close, HowToVote, Logout } from \"@mui/icons-material\";\nimport { Voting } from \"@daml.js/create-daml-app\";\nimport { useParty, useLedger, useStreamQueries } from \"@daml/react\";\nimport { useNavigate, Link } from \"react-router-dom\";\n\ntype Props = {\n  onLogout: () => void;\n};\n\nconst VoteScreen: React.FC<Props> = ({ onLogout }) => {\n  const hashUsername = useParty();\n  const ledger = useLedger();\n\n  const [Popup, setPopup] = React.useState(false);\n  const [popupText, setPopupText] = React.useState(\"\");\n\n  const handleClose = (\n    event: React.SyntheticEvent | Event,\n    reason?: string\n  ) => {\n    if (reason === \"clickaway\") {\n      return;\n    }\n    setPopup(false);\n  };\n  const action = (\n    <React.Fragment>\n      <IconButton\n        size=\"small\"\n        aria-label=\"close\"\n        color=\"inherit\"\n        onClick={handleClose}\n      >\n        <Close fontSize=\"small\" />\n      </IconButton>\n    </React.Fragment>\n  );\n\n  const assets = useStreamQueries(Voting.Voting);\n  let userContract = ledger.fetchByKey(Voting.Voting, hashUsername);\n\n  const [radioStatus, setRadioStatus] = useState(\"\");\n  // get current unix time stamp\n  const now = new Date().getTime();\n\n  const buttonHandler = async () => {\n    if (assets.contracts[0]?.payload.voted.includes(hashUsername)) {\n      setPopupText(\"You have already voted\");\n\n      setPopup(true);\n    } else {\n      await ledger\n        .exerciseByKey(\n          Voting.Voting.Vote,\n          assets.contracts[0]?.signatories[0],\n          { voter: hashUsername, vote: radioStatus, unixTime: now }\n        )\n        .catch(console.error);\n      setPopupText(\"Your vote has been cast. Please or close the browser tab\");\n\n      setPopup(true);\n    }\n  };\n\n  return (\n    <>\n      <Box textAlign={\"right\"} sx={{ p: 1 }}>\n        <Button\n          variant=\"outlined\"\n          color=\"inherit\"\n          startIcon={<Logout />}\n          onClick={onLogout}\n          component={Link}\n          to=\"/\"\n        >\n          Log Out\n        </Button>\n      </Box>\n      <Container>\n        <Grid\n          container\n          direction=\"column\"\n          justifyContent=\"center\"\n          alignItems=\"center\"\n          style={{ height: \"75vh\" }}\n        >\n          <Paper\n            sx={{ p: 3, borderRadius: \"16px\", width: \"90%\" }}\n            elevation={2}\n          >\n            <Grid container spacing={0}>\n              <Grid item>\n                <HowToVote sx={{ fontSize: 50 }} color=\"primary\" />\n              </Grid>\n\n              <Grid item>\n                <Grid item>\n                  <Typography variant=\"h5\" display=\"block\">\n                    Vote\n                  </Typography>\n                </Grid>\n                <Grid item>\n                  <Typography\n                    variant=\"subtitle1\"\n                    color=\"secondary\"\n                    display=\"block\"\n                    style={{ lineHeight: \"15px\" }}\n                  >\n                    Read the vote description carefully and choose an option\n                  </Typography>\n                </Grid>\n              </Grid>\n            </Grid>\n\n            <Divider />\n\n            <Typography variant=\"h6\" sx={{ pt: 2 }}>\n              Vote Description\n            </Typography>\n            {assets.contracts[0]?.payload?.subject ?? \"Loading...\"}\n\n            <Divider sx={{ pb: 2 }} />\n            <Box textAlign=\"center\">\n              <FormControl>\n                <FormLabel id=\"demo-radio-buttons-group-label\">\n                  Options\n                </FormLabel>\n                <RadioGroup\n                  aria-labelledby=\"demo-radio-buttons-group-label\"\n                  defaultValue=\"female\"\n                  name=\"radio-buttons-group\"\n                >\n                  <List>\n                    {assets.contracts[0]?.payload?.candidates.map((item) => (\n                      <ListItem key={item}>\n                        <FormControlLabel\n                          value={item}\n                          control={<Radio />}\n                          label={item}\n                          onChange={(event) => {\n                            setRadioStatus(item);\n                          }}\n                        />\n                      </ListItem>\n                    ))}\n                  </List>\n                </RadioGroup>\n              </FormControl>\n            </Box>\n            <Box textAlign=\"center\">\n              <Button\n                variant=\"contained\"\n                onClick={buttonHandler}\n                className=\"button\"\n                name=\"Create Vote\"\n                sx={{ m: 2, alignItems: \"center\" }}\n              >\n                Vote\n              </Button>\n            </Box>\n            <Snackbar\n              open={Popup}\n              autoHideDuration={4000}\n              onClose={handleClose}\n              message={popupText}\n              action={action}\n            />\n          </Paper>\n        </Grid>\n      </Container>\n    </>\n  );\n};\n\nexport default VoteScreen;\n"]},"metadata":{},"sourceType":"module"}