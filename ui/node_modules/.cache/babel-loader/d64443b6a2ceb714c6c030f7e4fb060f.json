{"ast":null,"code":"import _toConsumableArray from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/regenerator/index.js\";// Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React,{useState}from\"react\";import{Button,Container,Slider,List,ListItem,ListItemText,TextField,Typography,Box,Snackbar,Grid,Divider,IconButton,Paper}from\"@mui/material\";import{Key,Ballot,Delete,Close,KeyboardReturn}from\"@mui/icons-material\";import{Voting}from\"@daml.js/create-daml-app\";import{useParty,useLedger,useStreamQueries}from\"@daml/react\";import{createHash}from\"crypto\";import HelpPopup from\"./HelpPopup\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var voteKeys=[];var hashedVoteKeys=[];var MainView=function MainView(){var hashUsername=useParty();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),candidateList=_useState2[0],setCandidateList=_useState2[1];var _React$useState=React.useState(10),_React$useState2=_slicedToArray(_React$useState,2),value=_React$useState2[0],setValue=_React$useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),subjectText=_useState4[0],setSubjectText=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),candidateText=_useState6[0],setCandidateText=_useState6[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),Popup=_React$useState4[0],setPopup=_React$useState4[1];var _React$useState5=React.useState(\"\"),_React$useState6=_slicedToArray(_React$useState5,2),popupText=_React$useState6[0],setPopupText=_React$useState6[1];var assets=useStreamQueries(Voting.Voting);var ledger=useLedger();var buttonHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var button,_generateVoteKeys,_generateVoteKeys2,_voteKeys,_hashedVoteKeys,voteDetails;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();button=event.currentTarget;if(button.name===\"Create Vote\"&&assets.contracts.length===0){setPopupText(\"Vote Created\");setPopup(true);_generateVoteKeys=generateVoteKeys(value),_generateVoteKeys2=_slicedToArray(_generateVoteKeys,2),_voteKeys=_generateVoteKeys2[0],_hashedVoteKeys=_generateVoteKeys2[1];voteDetails={username:hashUsername,voters:_hashedVoteKeys,votes:[],voted:[],voteTimes:[],candidates:candidateList,subject:subjectText};ledger.create(Voting.Voting,voteDetails);}else{setPopupText(\"Vote In Progress\");setPopup(true);}case 3:case\"end\":return _context.stop();}}},_callee);}));return function buttonHandler(_x){return _ref.apply(this,arguments);};}();function hash(input){return createHash(\"sha256\").update(input).digest(\"hex\");}var generateVoteKeys=function generateVoteKeys(voterCount){for(var i=0;i<voterCount;i++){var crypto=require(\"crypto\");var key=crypto.randomBytes(20).toString(\"hex\");voteKeys.push(\"\".concat(key));hashedVoteKeys.push(hash(key));}return[voteKeys,hashedVoteKeys];};var addCandidate=function addCandidate(){if(candidateList.includes(candidateText)){setPopupText(\"Candidate already exists\");setPopup(true);}else{setCandidateText(\"\");// append candidateText to the start of candidateList\nsetCandidateList([candidateText].concat(_toConsumableArray(candidateList)));}};// copy voteKeys to clipboard\nvar copyVoteKeys=function copyVoteKeys(){navigator.clipboard.writeText(voteKeys.join(\"\\n\"));setPopupText(\"Keys Copied To Clipboard\");setPopup(true);};// export voteKeys to csv\nvar exportVoteKeys=function exportVoteKeys(){var csv=voteKeys.join(\"\\n\");var blob=new Blob([csv],{type:\"text/csv\"});var url=URL.createObjectURL(blob);var link=document.createElement(\"a\");link.href=url;link.download=\"voteKeys.csv\";link.click();setPopupText(\"Keys Exported\");setPopup(true);};var handleClose=function handleClose(event,reason){if(reason===\"clickaway\"){return;}setPopup(false);};var action=/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"close\",color:\"inherit\",onClick:handleClose,children:/*#__PURE__*/_jsx(Close,{fontSize:\"small\"})})});return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(Box,{sx:{p:1},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3,borderRadius:\"16px\"},elevation:2,children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",alignItems:\"center\",flexWrap:\"wrap\"},children:[/*#__PURE__*/_jsx(Ballot,{sx:{fontSize:45},color:\"primary\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h5\",children:\"Create A Vote\"})]}),/*#__PURE__*/_jsx(Divider,{sx:{p:0}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{pt:2},children:\"What is the vote on?\"}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsx(TextField,{id:\"outlined-basic\",label:\"Subject\",variant:\"outlined\",value:subjectText,onChange:function onChange(event){setSubjectText(event.target.value);},style:{width:\"94%\"},sx:{m:2}})}),/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",children:[\"Voters: \",value]}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsx(Slider,{value:value,\"aria-label\":\"Default\",valueLabelDisplay:\"auto\",name:\"slider\",sx:{m:2},style:{width:\"95%\"},onChange:function onChange(event){setValue(event.target.value);}})}),/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",children:[\"Candidates: \",candidateList.length]}),/*#__PURE__*/_jsxs(Box,{textAlign:\"center\",children:[/*#__PURE__*/_jsx(TextField,{id:\"outlined-basic\",label:\"Candidate\",variant:\"outlined\",value:candidateText//  onChange={handleChange}\n,onChange:function onChange(event){setCandidateText(event.target.value);},onKeyPress:function onKeyPress(event){if(event.key===\"Enter\"){event.preventDefault();addCandidate();}},style:{width:\"95%\"},sx:{m:2},InputProps:{endAdornment:/*#__PURE__*/_jsx(IconButton,{onClick:addCandidate,children:/*#__PURE__*/_jsx(KeyboardReturn,{})})}}),/*#__PURE__*/_jsx(List,{style:{width:\"95%\"},sx:{ml:2},children:candidateList.map(function(item){return/*#__PURE__*/_jsx(ListItem,{secondaryAction:/*#__PURE__*/_jsx(IconButton,{edge:\"end\",\"aria-label\":\"delete\",onClick:function onClick(e){setCandidateList(function(candidateList){return candidateList.filter(function(i){return i!==item;});});},children:/*#__PURE__*/_jsx(Delete,{})}),children:/*#__PURE__*/_jsx(ListItemText,{primary:item})},item);})})]}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:buttonHandler,className:\"button\",name:\"Create Vote\",sx:{m:2,alignItems:\"center\"},children:\"Create Vote\"})}),/*#__PURE__*/_jsx(Snackbar,{open:Popup,autoHideDuration:2000,onClose:handleClose,message:popupText,action:action})]})}),/*#__PURE__*/_jsx(Box,{sx:{p:1},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3,borderRadius:\"16px\"},elevation:2,children:[/*#__PURE__*/_jsxs(Grid,{container:true,children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Key,{sx:{fontSize:45},color:\"primary\"})}),/*#__PURE__*/_jsxs(Grid,{item:true,children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Typography,{variant:\"h5\",display:\"block\",children:\"Vote Keys\"})}),/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",color:\"secondary\",display:\"block\",style:{lineHeight:\"15px\"},children:\"Distribute vote keys between voters\"})})]}),/*#__PURE__*/_jsxs(Box,{textAlign:\"right\",sx:{flexGrow:1},children:[/*#__PURE__*/_jsx(Button,{sx:{margin:1},variant:\"contained\",onClick:exportVoteKeys,children:\"Export CSV\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:copyVoteKeys,children:\"Copy To Clipboard\"})]})]}),/*#__PURE__*/_jsx(List,{sx:{width:\"100%\",bgcolor:\"background.paper\",borderRadius:\"16px\",position:\"relative\",overflow:\"auto\",maxHeight:300,\"& ul\":{padding:0}},subheader:/*#__PURE__*/_jsx(\"li\",{}),children:[0].map(function(sectionId){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"ul\",{children:voteKeys.map(function(item){return/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"\".concat(item)})},\"item-\".concat(sectionId,\"-\").concat(item));})})},\"section-\".concat(sectionId));})})]})}),/*#__PURE__*/_jsx(HelpPopup,{heading:\"How To Create A Vote\",content:\" 1. Enter the subject of the vote.\\\\n 2. Enter the number of voters.\\\\n 3. Enter the number of candidates.\\\\n 4. Enter the candidates.\\\\n 5. Click on the create vote button.\\\\n 6. The vote will be created.\\\\n \"})]});};export default MainView;","map":{"version":3,"sources":["/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/src/components/MainView.tsx"],"names":["React","useState","Button","Container","Slider","List","ListItem","ListItemText","TextField","Typography","Box","Snackbar","Grid","Divider","IconButton","Paper","Key","Ballot","Delete","Close","KeyboardReturn","Voting","useParty","useLedger","useStreamQueries","createHash","HelpPopup","voteKeys","hashedVoteKeys","MainView","hashUsername","candidateList","setCandidateList","value","setValue","subjectText","setSubjectText","candidateText","setCandidateText","Popup","setPopup","popupText","setPopupText","assets","ledger","buttonHandler","event","preventDefault","button","currentTarget","name","contracts","length","generateVoteKeys","voteDetails","username","voters","votes","voted","voteTimes","candidates","subject","create","hash","input","update","digest","voterCount","i","crypto","require","key","randomBytes","toString","push","addCandidate","includes","copyVoteKeys","navigator","clipboard","writeText","join","exportVoteKeys","csv","blob","Blob","type","url","URL","createObjectURL","link","document","createElement","href","download","click","handleClose","reason","action","p","borderRadius","display","alignItems","flexWrap","fontSize","pt","target","width","m","endAdornment","ml","map","item","e","filter","lineHeight","flexGrow","margin","bgcolor","position","overflow","maxHeight","padding","sectionId"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React, { useState } from \"react\";\n\nimport {\n  Button,\n  Container,\n  Slider,\n  List,\n  ListItem,\n  ListItemText,\n  TextField,\n  Typography,\n  Box,\n  Snackbar,\n  Grid,\n  Divider,\n  IconButton,\n  Paper,\n} from \"@mui/material\";\n\nimport {\n  Key,\n  Ballot,\n  Delete,\n  Close,\n  KeyboardReturn,\n} from \"@mui/icons-material\";\n\nimport { Voting } from \"@daml.js/create-daml-app\";\n\nimport { useParty, useLedger, useStreamQueries } from \"@daml/react\";\n\nimport { createHash } from \"crypto\";\n\nimport HelpPopup from \"./HelpPopup\";\n\nlet voteKeys: string[] = [];\nlet hashedVoteKeys: string[] = [];\nconst MainView: React.FC = () => {\n  const hashUsername = useParty();\n  const [candidateList, setCandidateList] = useState<string[]>([]);\n\n  const [value, setValue] = React.useState<number>(10);\n  const [subjectText, setSubjectText] = useState(\"\");\n  const [candidateText, setCandidateText] = useState(\"\");\n  const [Popup, setPopup] = React.useState(false);\n  const [popupText, setPopupText] = React.useState(\"\");\n\n  const assets = useStreamQueries(Voting.Voting);\n\n  const ledger = useLedger();\n  const buttonHandler = async (event: React.MouseEvent<HTMLButtonElement>) => {\n    event.preventDefault();\n    const button: HTMLButtonElement = event.currentTarget;\n    if ((button.name === \"Create Vote\" && assets.contracts.length === 0)) {\n      setPopupText(\"Vote Created\");\n      setPopup(true);\n      const [voteKeys, hashedVoteKeys] = generateVoteKeys(value);\n\n      const voteDetails = {\n        username: hashUsername,\n        voters: hashedVoteKeys,\n        votes: [],\n        voted: [],\n        voteTimes: [],\n        candidates: candidateList,\n        subject: subjectText,\n      };\n      ledger.create(Voting.Voting, voteDetails);\n    } else {\n      setPopupText(\"Vote In Progress\");\n      setPopup(true);\n    }\n  };\n\n  function hash(input: string) {\n    return createHash(\"sha256\").update(input).digest(\"hex\");\n  }\n\n  const generateVoteKeys = (voterCount: any) => {\n    for (let i = 0; i < voterCount; i++) {\n      var crypto = require(\"crypto\");\n      var key = crypto.randomBytes(20).toString(\"hex\");\n      voteKeys.push(`${key}`);\n      hashedVoteKeys.push(hash(key));\n    }\n    return [voteKeys, hashedVoteKeys];\n  };\n\n  const addCandidate = () => {\n    if (candidateList.includes(candidateText)) {\n      setPopupText(\"Candidate already exists\");\n      setPopup(true);\n    } else {\n      setCandidateText(\"\");\n      // append candidateText to the start of candidateList\n      setCandidateList([candidateText, ...candidateList]);\n    }\n  };\n\n  // copy voteKeys to clipboard\n  const copyVoteKeys = () => {\n    navigator.clipboard.writeText(voteKeys.join(\"\\n\"));\n    setPopupText(\"Keys Copied To Clipboard\");\n    setPopup(true);\n  };\n\n  // export voteKeys to csv\n  const exportVoteKeys = () => {\n    const csv = voteKeys.join(\"\\n\");\n    const blob = new Blob([csv], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = \"voteKeys.csv\";\n    link.click();\n    setPopupText(\"Keys Exported\");\n    setPopup(true);\n  };\n\n  const handleClose = (\n    event: React.SyntheticEvent | Event,\n    reason?: string\n  ) => {\n    if (reason === \"clickaway\") {\n      return;\n    }\n\n    setPopup(false);\n  };\n  const action = (\n    <React.Fragment>\n      <IconButton\n        size=\"small\"\n        aria-label=\"close\"\n        color=\"inherit\"\n        onClick={handleClose}\n      >\n        <Close fontSize=\"small\" />\n      </IconButton>\n    </React.Fragment>\n  );\n\n  return (\n    <Container>\n      <Box sx={{ p: 1 }}>\n        <Paper sx={{ p: 3, borderRadius: \"16px\" }} elevation={2}>\n          <div\n            style={{\n              display: \"flex\",\n              alignItems: \"center\",\n              flexWrap: \"wrap\",\n            }}\n          >\n            <Ballot sx={{ fontSize: 45 }} color=\"primary\" />\n            <Typography variant=\"h5\">Create A Vote</Typography>\n          </div>\n          <Divider sx={{ p: 0 }} />\n\n          <Typography variant=\"h6\" sx={{ pt: 2 }}>\n            What is the vote on?\n          </Typography>\n          <Box textAlign=\"center\">\n            <TextField\n              id=\"outlined-basic\"\n              label=\"Subject\"\n              variant=\"outlined\"\n              value={subjectText}\n              onChange={(event) => {\n                setSubjectText(event.target.value);\n              }}\n              style={{ width: \"94%\" }}\n              sx={{ m: 2 }}\n            />\n          </Box>\n          <Typography variant=\"h6\">Voters: {value}</Typography>\n\n          <Box textAlign=\"center\">\n            <Slider\n              value={value}\n              aria-label=\"Default\"\n              valueLabelDisplay=\"auto\"\n              name=\"slider\"\n              sx={{ m: 2 }}\n              style={{ width: \"95%\" }}\n              onChange={(event: any) => {\n                setValue(event.target.value);\n              }}\n            />\n          </Box>\n          <Typography variant=\"h6\">\n            Candidates: {candidateList.length}\n          </Typography>\n\n          <Box textAlign=\"center\">\n            <TextField\n              id=\"outlined-basic\"\n              label=\"Candidate\"\n              variant=\"outlined\"\n              value={candidateText}\n              //  onChange={handleChange}\n              onChange={(event) => {\n                setCandidateText(event.target.value);\n              }}\n              onKeyPress={(event) => {\n                if (event.key === \"Enter\") {\n                  event.preventDefault();\n                  addCandidate();\n                }\n              }}\n              style={{ width: \"95%\" }}\n              sx={{ m: 2 }}\n              InputProps={{\n                endAdornment: (\n                  <IconButton onClick={addCandidate}>\n                    <KeyboardReturn />\n                  </IconButton>\n                ),\n              }}\n            />\n\n            <List style={{ width: \"95%\" }} sx={{ ml: 2 }}>\n              {candidateList.map((item) => (\n                <ListItem\n                  key={item}\n                  secondaryAction={\n                    <IconButton\n                      edge=\"end\"\n                      aria-label=\"delete\"\n                      onClick={(e) => {\n                        setCandidateList((candidateList) =>\n                          candidateList.filter((i) => i !== item)\n                        );\n                      }}\n                    >\n                      <Delete />\n                    </IconButton>\n                  }\n                >\n                  <ListItemText primary={item} />\n                </ListItem>\n              ))}\n            </List>\n          </Box>\n\n          <Box textAlign=\"center\">\n            <Button\n              variant=\"contained\"\n              onClick={buttonHandler}\n              className=\"button\"\n              name=\"Create Vote\"\n              sx={{ m: 2, alignItems: \"center\" }}\n            >\n              Create Vote\n            </Button>\n          </Box>\n          <Snackbar\n            open={Popup}\n            autoHideDuration={2000}\n            onClose={handleClose}\n            message={popupText}\n            action={action}\n          />\n        </Paper>\n      </Box>\n\n      <Box sx={{ p: 1 }}>\n        <Paper sx={{ p: 3, borderRadius: \"16px\" }} elevation={2}>\n          <Grid container>\n            <Grid item>\n              <Key sx={{ fontSize: 45 }} color=\"primary\" />\n            </Grid>\n\n            <Grid item>\n              <Grid item>\n                <Typography variant=\"h5\" display=\"block\">\n                  Vote Keys\n                </Typography>\n              </Grid>\n              <Grid item>\n                <Typography\n                  variant=\"subtitle1\"\n                  color=\"secondary\"\n                  display=\"block\"\n                  style={{ lineHeight: \"15px\" }}\n                >\n                  Distribute vote keys between voters\n                </Typography>\n              </Grid>\n            </Grid>\n            <Box textAlign=\"right\" sx={{ flexGrow: 1 }}>\n              <Button\n                sx={{ margin: 1 }}\n                variant=\"contained\"\n                onClick={exportVoteKeys}\n              >\n                Export CSV\n              </Button>\n              <Button variant=\"contained\" onClick={copyVoteKeys}>\n                Copy To Clipboard\n              </Button>\n            </Box>\n          </Grid>\n\n          <List\n            sx={{\n              width: \"100%\",\n              bgcolor: \"background.paper\",\n              borderRadius: \"16px\",\n              position: \"relative\",\n              overflow: \"auto\",\n              maxHeight: 300,\n              \"& ul\": { padding: 0 },\n            }}\n            subheader={<li />}\n          >\n            {[0].map((sectionId) => (\n              <li key={`section-${sectionId}`}>\n                <ul>\n                  {voteKeys.map((item) => (\n                    <ListItem key={`item-${sectionId}-${item}`}>\n                      <ListItemText primary={`${item}`} />\n                    </ListItem>\n                  ))}\n                </ul>\n              </li>\n            ))}\n          </List>\n        </Paper>\n      </Box>\n\n      <HelpPopup\n        heading=\"How To Create A Vote\"\n        content=\"\n          1. Enter the subject of the vote.\\n\n          2. Enter the number of voters.\\n\n          3. Enter the number of candidates.\\n\n          4. Enter the candidates.\\n\n          5. Click on the create vote button.\\n\n          6. The vote will be created.\\n\n        \"\n      ></HelpPopup>\n    </Container>\n  );\n};\n\nexport default MainView;\n"]},"metadata":{},"sourceType":"module"}