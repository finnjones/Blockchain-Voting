{"ast":null,"code":"import _asyncToGenerator from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from\"react\";import{Button,Grid,List,ListItem,Container,FormLabel,FormControlLabel,RadioGroup,FormControl,Typography,Radio,Divider,Box,Snackbar,IconButton,Paper}from\"@mui/material\";import{Close,HowToVote}from\"@mui/icons-material\";import{Voting}from\"@daml.js/create-daml-app\";import{useParty,useLedger,useStreamQueries}from\"@daml/react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var VoteScreen=function VoteScreen(_ref){var _assets$contracts$0$p,_assets$contracts$4,_assets$contracts$4$p,_assets$contracts$5,_assets$contracts$5$p;var onLogout=_ref.onLogout;var hashUsername=useParty();var ledger=useLedger();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),Popup=_React$useState2[0],setPopup=_React$useState2[1];var _React$useState3=React.useState(\"\"),_React$useState4=_slicedToArray(_React$useState3,2),popupText=_React$useState4[0],setPopupText=_React$useState4[1];// const async delay(ms: number) {\n//   await new Promise(resolve => setTimeout(()=>resolve(), ms)).then(()=>console.log(\"fired\"));\n// }\nvar handleClose=function handleClose(event,reason){if(reason===\"clickaway\"){return;}setPopup(false);};var action=/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"close\",color:\"inherit\",onClick:handleClose,children:/*#__PURE__*/_jsx(Close,{fontSize:\"small\"})})});var assets=useStreamQueries(Voting.Voting);var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),radioStatus=_useState2[0],setRadioStatus=_useState2[1];var buttonHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _assets$contracts$,_assets$contracts$3;var _assets$contracts$2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!((_assets$contracts$=assets.contracts[0])!==null&&_assets$contracts$!==void 0&&_assets$contracts$.payload.voted.includes(hashUsername))){_context.next=5;break;}setPopupText(\"You have already voted\");setPopup(true);_context.next=10;break;case 5:setPopupText(\"Your vote has been cast you will now be logged out in 3 seconds.\");setPopup(true);setTimeout(function(){onLogout();},3000);_context.next=10;return ledger.exerciseByKey(Voting.Voting.Vote,(_assets$contracts$2=assets.contracts[0])===null||_assets$contracts$2===void 0?void 0:_assets$contracts$2.signatories[0],{voter:hashUsername,vote:radioStatus}).catch(console.error);case 10:console.log((_assets$contracts$3=assets.contracts[0])===null||_assets$contracts$3===void 0?void 0:_assets$contracts$3.payload.voted);case 11:case\"end\":return _context.stop();}}},_callee);}));return function buttonHandler(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsx(Grid,{container:true,direction:\"column\",justifyContent:\"center\",alignItems:\"center\",style:{height:\"75vh\"},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3,borderRadius:\"16px\",width:\"90%\"},elevation:2,children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:0,children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(HowToVote,{sx:{fontSize:50},color:\"primary\"})}),/*#__PURE__*/_jsxs(Grid,{direction:\"column\",children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Typography,{variant:\"h5\",display:\"block\",children:\"Vote\"})}),/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",color:\"secondary\",display:\"block\",style:{lineHeight:\"15px\"},children:\"Read the vote description carefully and choose an option\"})})]})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{pt:2},children:\"Vote Description\"}),(_assets$contracts$0$p=(_assets$contracts$4=assets.contracts[0])===null||_assets$contracts$4===void 0?void 0:(_assets$contracts$4$p=_assets$contracts$4.payload)===null||_assets$contracts$4$p===void 0?void 0:_assets$contracts$4$p.subject)!==null&&_assets$contracts$0$p!==void 0?_assets$contracts$0$p:\"Loading...\",/*#__PURE__*/_jsx(Divider,{sx:{pb:2}}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsxs(FormControl,{children:[/*#__PURE__*/_jsx(FormLabel,{id:\"demo-radio-buttons-group-label\",children:\"Options\"}),/*#__PURE__*/_jsx(RadioGroup,{\"aria-labelledby\":\"demo-radio-buttons-group-label\",defaultValue:\"female\",name:\"radio-buttons-group\",children:/*#__PURE__*/_jsx(List,{children:(_assets$contracts$5=assets.contracts[0])===null||_assets$contracts$5===void 0?void 0:(_assets$contracts$5$p=_assets$contracts$5.payload)===null||_assets$contracts$5$p===void 0?void 0:_assets$contracts$5$p.candidates.map(function(item){return/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(FormControlLabel,{value:item,control:/*#__PURE__*/_jsx(Radio,{}),label:item,onChange:function onChange(event){console.log(item);setRadioStatus(item);}})},item);})})})]})}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:buttonHandler,className:\"button\",name:\"Create Vote\",sx:{m:2,alignItems:\"center\"},children:\"Vote\"})}),/*#__PURE__*/_jsx(Snackbar,{open:Popup,autoHideDuration:2000,onClose:handleClose,message:popupText,action:action})]})})});};export default VoteScreen;","map":{"version":3,"sources":["/Users/finn.jones/Documents/Github/Blockchain-Voting/Testing/create-daml-app/ui/src/components/VoteScreen.tsx"],"names":["React","useState","Button","Grid","List","ListItem","Container","FormLabel","FormControlLabel","RadioGroup","FormControl","Typography","Radio","Divider","Box","Snackbar","IconButton","Paper","Close","HowToVote","Voting","useParty","useLedger","useStreamQueries","VoteScreen","onLogout","hashUsername","ledger","Popup","setPopup","popupText","setPopupText","handleClose","event","reason","action","assets","radioStatus","setRadioStatus","buttonHandler","contracts","payload","voted","includes","setTimeout","exerciseByKey","Vote","signatories","voter","vote","catch","console","error","log","height","p","borderRadius","width","fontSize","lineHeight","pt","subject","pb","candidates","map","item","m","alignItems"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport {\n  Button,\n  Grid,\n  List,\n  ListItem,\n  Container,\n  FormLabel,\n  FormControlLabel,\n  RadioGroup,\n  FormControl,\n  Typography,\n  Radio,\n  Divider,\n  Box,\n  Snackbar,\n  IconButton,\n  Paper,\n} from \"@mui/material\";\nimport { Close, HowToVote } from \"@mui/icons-material\";\nimport { Voting } from \"@daml.js/create-daml-app\";\nimport { useParty, useLedger, useStreamQueries } from \"@daml/react\";\n\ntype Props = {\n  onLogout: () => void;\n};\n\nconst VoteScreen: React.FC<Props> = ({ onLogout }) => {\n  const hashUsername = useParty();\n  const ledger = useLedger();\n\n  const [Popup, setPopup] = React.useState(false);\n  const [popupText, setPopupText] = React.useState(\"\");\n  // const async delay(ms: number) {\n  //   await new Promise(resolve => setTimeout(()=>resolve(), ms)).then(()=>console.log(\"fired\"));\n  // }\n\n  const handleClose = (\n    event: React.SyntheticEvent | Event,\n    reason?: string\n  ) => {\n    if (reason === \"clickaway\") {\n      return;\n    }\n    setPopup(false);\n  };\n  const action = (\n    <React.Fragment>\n      <IconButton\n        size=\"small\"\n        aria-label=\"close\"\n        color=\"inherit\"\n        onClick={handleClose}\n      >\n        <Close fontSize=\"small\" />\n      </IconButton>\n    </React.Fragment>\n  );\n\n  const assets = useStreamQueries(Voting.Voting);\n  const [radioStatus, setRadioStatus] = useState(\"\");\n\n  const buttonHandler = async () => {\n    if (assets.contracts[0]?.payload.voted.includes(hashUsername)) {\n      setPopupText(\"You have already voted\");\n\n      setPopup(true);\n    } else {\n      setPopupText(\n        \"Your vote has been cast you will now be logged out in 3 seconds.\"\n      );\n\n      setPopup(true);\n\n      setTimeout(() => {\n        onLogout();\n      }, 3000);\n\n      await ledger\n        .exerciseByKey(\n          Voting.Voting.Vote,\n          assets.contracts[0]?.signatories[0],\n          { voter: hashUsername, vote: radioStatus }\n        )\n        .catch(console.error);\n    }\n    console.log(assets.contracts[0]?.payload.voted);\n  };\n\n  return (\n    <Container>\n      <Grid\n        container\n        direction=\"column\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        style={{ height: \"75vh\" }}\n      >\n        <Paper sx={{ p: 3, borderRadius: \"16px\", width: \"90%\" }} elevation={2}>\n          <Grid container spacing={0}>\n            <Grid item>\n              <HowToVote sx={{ fontSize: 50 }} color=\"primary\" />\n            </Grid>\n\n            <Grid direction=\"column\">\n              <Grid item>\n                <Typography variant=\"h5\" display=\"block\">\n                  Vote\n                </Typography>\n              </Grid>\n              <Grid item>\n                <Typography\n                  variant=\"subtitle1\"\n                  color=\"secondary\"\n                  display=\"block\"\n                  style={{ lineHeight: \"15px\" }}\n                >\n                  Read the vote description carefully and choose an option\n                </Typography>\n              </Grid>\n            </Grid>\n          </Grid>\n\n          <Divider />\n\n          <Typography variant=\"h6\" sx={{ pt: 2 }}>\n            Vote Description\n          </Typography>\n          {assets.contracts[0]?.payload?.subject ?? \"Loading...\"}\n\n          <Divider sx={{ pb: 2 }} />\n          <Box textAlign=\"center\">\n            <FormControl>\n              <FormLabel id=\"demo-radio-buttons-group-label\">Options</FormLabel>\n              <RadioGroup\n                aria-labelledby=\"demo-radio-buttons-group-label\"\n                defaultValue=\"female\"\n                name=\"radio-buttons-group\"\n              >\n                <List>\n                  {assets.contracts[0]?.payload?.candidates.map((item) => (\n                    <ListItem key={item}>\n                      <FormControlLabel\n                        value={item}\n                        control={<Radio />}\n                        label={item}\n                        onChange={(event) => {\n                          console.log(item);\n                          setRadioStatus(item);\n                        }}\n                      />\n                    </ListItem>\n                  ))}\n                </List>\n              </RadioGroup>\n            </FormControl>\n          </Box>\n          <Box textAlign=\"center\">\n            <Button\n              variant=\"contained\"\n              onClick={buttonHandler}\n              className=\"button\"\n              name=\"Create Vote\"\n              sx={{ m: 2, alignItems: \"center\" }}\n            >\n              Vote\n            </Button>\n          </Box>\n          <Snackbar\n            open={Popup}\n            autoHideDuration={2000}\n            onClose={handleClose}\n            message={popupText}\n            action={action}\n          />\n        </Paper>\n      </Grid>\n    </Container>\n  );\n};\n\nexport default VoteScreen;\n"]},"metadata":{},"sourceType":"module"}